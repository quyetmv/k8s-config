# Template External Secrets cấu hình Vault backend
# Copy file này sang môi trường tương ứng và thay các giá trị TODO_*
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: TODO_SECRET_STORE_NAME
  namespace: TODO_ADDONS_NAMESPACE
spec:
  provider:
    vault:
      server: https://vault.example.com:8200
      path: secret/data # đổi theo engine đã enable
      version: v2
      auth:
        method: kubernetes
        mountPath: kubernetes
        role: TODO_VAULT_ROLE
        serviceAccountRef:
          name: TODO_SERVICE_ACCOUNT
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: TODO_EXTERNAL_SECRET_NAME
  namespace: TODO_TARGET_NAMESPACE
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: SecretStore
    name: TODO_SECRET_STORE_NAME
  target:
    name: TODO_GENERATED_SECRET_NAME
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson # đổi theo kiểu secret cần tạo
  data:
    - secretKey: .dockerconfigjson # key trong Secret sẽ tạo
      remoteRef:
        key: secret/data/dockerhub # path trong Vault
        property: dockerconfigjson # field cụ thể
